<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/intesso/connect-livereload#readme"

    >connect-livereload (v0.6.0)</a>
</h1>
<h4>connect middleware for adding the livereload script to the response</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.connect-livereload">module connect-livereload</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.connect-livereload.connect-livereload">
            function <span class="apidocSignatureSpan"></span>connect-livereload
            <span class="apidocSignatureSpan">(opt)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.connect-livereload" id="apidoc.module.connect-livereload">module connect-livereload</a></h1>


    <h2>
        <a href="#apidoc.element.connect-livereload.connect-livereload" id="apidoc.element.connect-livereload.connect-livereload">
        function <span class="apidocSignatureSpan"></span>connect-livereload
        <span class="apidocSignatureSpan">(opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function livereload(opt) {
  // options
  opt = opt || {};
  var ignore = opt.ignore || opt.excludeList || [/\.js(\?.*)?$/, /\.css(\?.*)?$/, /\.svg(\?.*)?$/, /\.ico(\?.*)?$/,
    /\.woff(\?.*)?$/, /\.png(\?.*)?$/, /\.jpg(\?.*)?$/, /\.jpeg(\?.*)?$/, /\.gif(\?.*)?$/, /\.pdf(\?.*)?$/,
    /\.json(\?.*)?$/
  ];

  var include = opt.include || [/.*/];
  var html = opt.html || _html;
  var rules = opt.rules || [{
      match: /&#x3c;\/body&#x3e;(?![\s\S]*&#x3c;\/body&#x3e;)/i,
      fn: prepend
    }, {
      match: /&#x3c;\/html&#x3e;(?![\s\S]*&#x3c;\/html&#x3e;)/i,
      fn: prepend
    }, {
      match: /&#x3c;\!DOCTYPE.+?&#x3e;/i,
      fn: append
    }];
  var disableCompression = opt.disableCompression || false;
  var port = opt.port || 35729;
  var plugins = opt.plugins || [];

  function snippet(host) {
    var src = opt.src || &#x27;//&#x27; + host + &#x27;:&#x27; + port + &#x27;/livereload.js?snipver=1&#x27;;
    return [src].concat(plugins).map(function(source) {
      return &#x27;&#x3c;script src=&#x22;&#x27; + source + &#x27;&#x22; async=&#x22;&#x22; defer=&#x22;&#x22;&#x3e;&#x3c;/script&#x3e;&#x27;;
    }).join(&#x27;&#x27;);
  }

  // helper functions
  var regex = (function () {
    var matches = rules.map(function (item) {
      return item.match.source;
    }).join(&#x27;|&#x27;);

    return new RegExp(matches, &#x27;i&#x27;);
  })();

  function prepend(w, s) {
    return s + w;
  }

  function append(w, s) {
    return w + s;
  }

  function _html(str) {
    if (!str) return false;
    return /&#x3c;[:_-\w\s\!\/\=\&#x22;\&#x27;]+&#x3e;/i.test(str);
  }

  function exists(body) {
    if (!body) return false;
    return regex.test(body);
  }

  function snip(body) {
    if (!body) return false;
    return (~body.lastIndexOf(&#x22;/livereload.js&#x22;));
  }

  function snap(body, host) {
    var _body = body;
    rules.some(function (rule) {
      if (rule.match.test(body)) {
        _body = body.replace(rule.match, function(w) {
          return rule.fn(w, snippet(host));
        });
        return true;
      }
      return false;
    });
    return _body;
  }

  function accept(req) {
    var ha = req.headers[&#x22;accept&#x22;];
    if (!ha) return false;
    return (~ha.indexOf(&#x22;html&#x22;));
  }

  function check(str, arr) {
    if (!str) return true;
    return arr.some(function (item) {
      if ((item.test &#x26;&#x26; item.test(str)) || ~str.indexOf(item)) return true;
      return false;
    });
  }

  // middleware
  return function livereload(req, res, next) {
    var host = opt.hostname || req.headers.host.split(&#x27;:&#x27;)[0];

    if (res._livereload) return next();
    res._livereload = true;

    if (!accept(req) || !check(req.url, include) || check(req.url, ignore)) {
      return next();
    }

    // Disable G-Zip to enable proper inspecting of HTML
    if (disableCompression) {
      req.headers[&#x27;accept-encoding&#x27;] = &#x27;identity&#x27;;
    }

    var runPatches = true;
    var writeHead = res.writeHead;
    var write = res.write;
    var end = res.end;

    res.push = function (chunk) {
      res.data = (res.data || &#x27;&#x27;) + chunk;
    };

    res.inject = res.write = function (string, encoding) {
      if (!runPatches) return write.call(res, string, encoding);

      if (string !== undefined) {
        var body = string instanceof Buffer ? string.toString(encoding) : string;
        // If this chunk must receive a snip, do so
        if (exists(body) &#x26;&#x26; !snip(res.data)) {
          res.push(snap(body, host));
          return true;
        }
        // If in doubt, simply buffer the data for later inspection (on `end` function)
        else {
          res.push(body);
          return true;
        }
      }
      return true;
    };

    res.writeHead = function () {
      if (!runPatches) return writeHead.apply(res, arguments);

      var headers = arguments[arguments.length - 1];
      if (typeof headers === &#x27;object&#x27;) {
        for (var name in headers) {
          if (/content-length/i.test(name)) {
            delete headers[name];
          }
        }
      }

      if (res.getHeader(&#x27;content-length&#x27;)) res.removeHeader(&#x27;content-length&#x27;);

      writeHead.apply(res, arguments);
    };

    res.end = function (string, encoding) {
      if (!runPatches) return end.call(res, string, encoding);

      // If there are remaining byt ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
